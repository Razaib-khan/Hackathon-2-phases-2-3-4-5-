name: Sync Backend to Hugging Face Hub

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  sync-to-hf:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Hugging Face Hub CLI
        run: pip install huggingface_hub

      - name: Sync Backend Code to Hugging Face Hub
        run: |
          git clone https://huggingface.co/spaces/${{ secrets.HF_SPACE_REPO_ID }} hf_space
          cp -r backend/* hf_space/
          cd hf_space
          git add .
          git config user.name github-actions
          git config user.email github-actions@github.com
          git commit -m "Update backend from GitHub" || exit 0  # exit 0 to avoid error if nothing to commit
          git push
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}